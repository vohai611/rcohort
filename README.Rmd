---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = FALSE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# rcohort

<!-- badges: start -->
<!-- badges: end -->

The goal of `rcohort` is to perform cohort analysis with R. This package build on top of `data.table` hence it should bring good speed!

## Installation

You can install the development version of `rcohort` from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("vohai611/rcohort")
```

## Example

This is a basic example which shows you how to execute cohort analysis  with `rcohort`

```{r}
df = readRDS("example-data/online-retail.rds")
```

This is a typical dataset of online retailer ([Source](https://www.kaggle.com/code/mahmoudelfahl/cohort-analysis-customer-segmentation-with-rfm/data))

```{r}
head(df)
```

`cohort_count()` perform cohort analysis by counting the appearance of customer in each time period. In particular, Customer are grouped by the first time they appear in the dataset. We can choose the rounded time to every  "month", "week", "quarter" or "year". 

```{r example}
library(rcohort)

df |>
  cohort_count(.id_col = CustomerID,
               .time_col = InvoiceDate,
               time_unit = "month")
```

To include group of all customer, use `all_group = TRUE`

```{r}
df |>
  cohort_count(.id_col = CustomerID,
               .time_col = InvoiceDate,
               time_unit = "month",
               all_group = TRUE)
```

Beside counting the appearance of customers, you can summarise cohort performance over time. For example, we can observe the change of the revenue over time.

```{r}
df$Revenue = df$Quantity * df$UnitPrice

cohort_df = df |> 
  cohort_summarise(.id_col = CustomerID,
                   .time_col = InvoiceDate,
                  .summarise_col = Revenue,.fn = "sum", time_unit = "month",
                  percent_form = TRUE) 
cohort_df
```

We can also quick visualize cohort data by calling `auto_plot`

```{r fig.width=8}
cohort_df |> auto_plot("tile")
```

